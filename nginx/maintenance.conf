# Generated maintenance include. Mounted to /etc/nginx/conf.d/maintenance.conf
# Toggle via env var or by editing this file inside the container and nginx -s reload.

## Maintenance mode mapping based on switch variable set in per-server context (mode.conf)
## $maintenance_switch will be set to 'on' or 'off' (default empty -> off)
map $maintenance_switch $maintenance_mode {
	default off;
	on      on;
	off     off;
}

# Exempt paths:
# - /dev/** (developer area)
# - /api/webhooks/**
# - /api/health
map $request_uri $is_maint_exempt {
	default 0;
	~^/dev(?:/|$)                         1;  # allow /dev and /dev/... (frontend dev tools)
	~^/api/webhooks/                     1;  # allow incoming webhooks
	~^/api/health$                       1;  # health checks
	~^/api/dev/maintenance-status$       1;  # status endpoint
	~^/api/dev/maintenance$              1;  # frontend overlay state
	~^/api/dev/toggle-nginx-maint$       1;  # toggle endpoint (optional)
}
