# Generated maintenance include. Mounted to /etc/nginx/conf.d/maintenance.conf
# Toggle via env var or by editing this file inside the container and nginx -s reload.

# MAINTENANCE variable gets default from env. If not set, off.
map "$MAINTENANCE" $maintenance_mode {
  default off;
  "on" on;
  "1"  on;
  "true" on;
}

# Bypass cookie: X-MAINT-BYPASS=allow (case-insensitive match)
map $http_cookie $has_maint_bypass {
  default 0;
  ~*(?:^|;\s*)X-MAINT-BYPASS=allow(?:;|$) 1;
}

# Exempt paths:
# - /dev/** (developer area)
# - /api/webhooks/**
# - /api/health
map $request_uri $is_maint_exempt {
  default 0;
  ~^/dev/ 1;
  ~^/api/webhooks/ 1;
  ~^/api/health$ 1;
}
