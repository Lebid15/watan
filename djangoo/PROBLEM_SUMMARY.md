# ุชูุฎูุต ุงููุดููุฉ - Multi-hop Chain Forwarding

## ๐ฏ **ุงููุดููุฉ ุงูุฃุณุงุณูุฉ:**
ูุธุงู ุงูุชูุฌูู ูุชุนุฏุฏ ุงููุฑุงุญู (Multi-hop Chain) ูุง ูุนูู ุจุดูู ุตุญูุญ. ุงูุทูุจุงุช ูุง ุชูุชูู ุชููุงุฆูุงู ูู ูุณุชุฃุฌุฑ ุฅูู ุขุฎุฑ ูู ุงูุณูุณูุฉ.

## ๐ **ุงููุณุงุฑ ุงููุทููุจ:**
```
Khalil (User) โ Al-Sham (Tenant) โ ShamTech (Tenant) โ znet (External Provider)
```

## โ **ุงููุดุงูู ุงูููุชุดูุฉ:**

### 1. **ูุดููุฉ ุนุฑุถ ุนููุฏ API:**
- **ุงููุดููุฉ**: ุนููุฏ API ูู Al-Sham ูุธูุฑ "Manual" ุจุฏู ุงุณู ุงููุณุชุฃุฌุฑ ุงูุชุงูู
- **ุงูุญู ุงููุทุจู**: ุชู ุฅุตูุงุญ `chain_path` ููุนุฑุถ "diana" ุจุฏู "ุชู ุงูุชูุฌูู"
- **ุงููุชูุฌุฉ**: โ ุชู ุงูุญู

### 2. **ูุดููุฉ ุงูุชูุฌูู ุงูุชููุงุฆู:**
- **ุงููุดููุฉ**: ุงูุทูุจ ูุง ููุชูู ุชููุงุฆูุงู ูู Al-Sham ุฅูู ShamTech
- **ุงูุณุจุจ**: ุงูุชูุฌูู ุงูุชููุงุฆู ูุง ููุดุฆ ุทูุจ ุฌุฏูุฏ ูู ุงููุณุชุฃุฌุฑ ุงูุชุงูู
- **ุงูุญู ุงููุคูุช**: ุชู ุฅูุดุงุก ุทูุจ ูุฏููุงู ูู ShamTech

### 3. **ูุดููุฉ "dispatch failed":**
- **ุงููุดููุฉ**: ุนูุฏ ูุญุงููุฉ ุงูุชูุฌูู ุงููุฏูู ูู ShamTech ุฅูู znetุ ุชุธูุฑ ุฑุณุงูุฉ "dispatch failed"
- **ุงูุณุจุจ**: ุฅุนุฏุงุฏุงุช ุงูุชูุฌูู ุบูุฑ ููุชููุฉ ุฃู ูุฒูุฏ znet ุบูุฑ ูุชุงุญ

## ๐ง **ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ:**

### โ **ูุง ุชู ุฅูุฌุงุฒู:**
1. **ุฅุตูุงุญ `chain_path`** ูู Al-Sham ููุนุฑุถ ุงุณู ุงููุณุชุฃุฌุฑ ุงูุชุงูู
2. **ุฅุนุฏุงุฏ PackageRouting ู PackageMapping** ููุฑุจุท ุจูู ุงููุณุชุฃุฌุฑูู
3. **ุฅุถุงูุฉ ูุฒูุฏูู** (znet, barakat) ูููุณุชุฃุฌุฑูู
4. **ุฅูุดุงุก ุทูุจุงุช ุชุฌุฑูุจูุฉ** ูุงุฎุชุจุงุฑ ุงููุณุงุฑ

### โ **ูุง ูู ูุชู ุญูู:**
1. **ุงูุชูุฌูู ุงูุชููุงุฆู** ูู Al-Sham ุฅูู ShamTech
2. **ุงูุชูุฌูู ุงููุฏูู** ูู ShamTech ุฅูู znet
3. **ุชุชุจุน ุงููุณุงุฑ** ุจูุงุณุทุฉ Celery worker

## ๐ **ุงููููุงุช ุงููููุฉ:**

### Backend:
- `djangoo/apps/orders/services.py` - ููุทู ุงูุชูุฌูู
- `djangoo/apps/orders/serializers.py` - ุนุฑุถ chainPath
- `djangoo/apps/orders/views.py` - ูุงุฌูุงุช API

### Frontend:
- `frontend/src/app/admin/orders/page.tsx` - ุนุฑุถ ุนููุฏ API

### Scripts:
- `djangoo/create_test_order.py` - ุฅูุดุงุก ุทูุจ ุชุฌุฑูุจู
- `djangoo/fix_alsham_routing.py` - ุฅุตูุงุญ ุงูุชูุฌูู
- `djangoo/create_missing_shamtech_order.py` - ุฅูุดุงุก ุทูุจ ููููุฏ

## ๐ฏ **ุงูุฎุทูุงุช ุงููุทููุจุฉ:**

### 1. **ุฅุตูุงุญ ุงูุชูุฌูู ุงูุชููุงุฆู:**
- ุชุนุฏูู `try_auto_dispatch` ูุฅูุดุงุก ุทูุจ ุฌุฏูุฏ ูู ุงููุณุชุฃุฌุฑ ุงูุชุงูู
- ุฅุถุงูุฉ ููุทู `CHAIN_FORWARDING` ูู `services.py`

### 2. **ุฅุตูุงุญ ุงูุชูุฌูู ุงููุฏูู:**
- ูุญุต ุฅุนุฏุงุฏุงุช PackageRouting ู PackageMapping
- ุงูุชุฃูุฏ ูู ุชููุฑ ูุฒูุฏ znet
- ุฅุตูุงุญ ุฑุณุงูุฉ "dispatch failed"

### 3. **ุฅุถุงูุฉ ุชุชุจุน ุงููุณุงุฑ:**
- ุชุญุฏูุซ Celery worker ูุชุชุจุน ุงููุณุงุฑ ูุชุนุฏุฏ ุงููุฑุงุญู
- ุฅุถุงูุฉ `chain_path` propagation ููููุฒุฉ ุงูุฑุงุจุนุฉ

## ๐ **ููุชุญูู:**
1. **Al-Sham**: ูุฌุจ ุฃู ูุธูุฑ "diana" ูู ุนููุฏ API
2. **ShamTech**: ูุฌุจ ุฃู ูุธูุฑ ุงูุทูุจ ูู ูุงุฆูุฉ ุงูุทูุจุงุช
3. **znet**: ูุฌุจ ุฃู ูุชู ุงูุชูุฌูู ุจูุฌุงุญ ุจุฏูู "dispatch failed"

## ๐ **ููุงุญุธุงุช:**
- ุงููุธุงู ูุนูู ููุทูุจุงุช ุงููุจุงุดุฑุฉ (ูุณุชุฃุฌุฑ โ ูุฒูุฏ ุฎุงุฑุฌู)
- ุงููุดููุฉ ูู ุงูุชูุฌูู ูุชุนุฏุฏ ุงููุฑุงุญู (ูุณุชุฃุฌุฑ โ ูุณุชุฃุฌุฑ โ ูุฒูุฏ ุฎุงุฑุฌู)
- ุงูุจูุงูุงุช ุชุตู ุจุดูู ุตุญูุญ ูู Backend ุฅูู Frontend
- ุงููุดููุฉ ูู ููุทู ุงูุชูุฌูู ูููุณ ูู ุงูุนุฑุถ







